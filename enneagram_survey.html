<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>에니어그램 성격유형 검사</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">에니어그램 성격유형 검사</h1>
            <p class="text-gray-600">자신의 성격유형을 알아보세요</p>
        </div>

        <!-- File Upload Section -->
        <div id="uploadSection" class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8 mb-8">
            <div class="text-center">
                <i class="fas fa-file-excel text-6xl text-green-500 mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">설문지 파일 업로드</h2>
                <p class="text-gray-600 mb-6">81문항이 포함된 엑셀 파일을 업로드해주세요</p>
                
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 mb-4">
                    <input type="file" id="fileInput" accept=".xlsx,.xls" class="hidden">
                    <label for="fileInput" class="cursor-pointer">
                        <div class="text-center">
                            <i class="fas fa-upload text-3xl text-gray-400 mb-2"></i>
                            <p class="text-gray-600">파일을 선택하거나 드래그하여 업로드</p>
                        </div>
                    </label>
                </div>
                
                <div id="fileName" class="text-sm text-gray-500 mb-4 hidden"></div>
                <button id="startSurvey" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    <i class="fas fa-play mr-2"></i>검사 시작
                </button>
            </div>
        </div>

        <!-- Survey Section -->
        <div id="surveySection" class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-8 hidden">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">설문 진행</h2>
                    <div class="text-sm text-gray-600">
                        <span id="currentQuestion">1</span> / <span id="totalQuestions">81</span>
                    </div>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progressBar" class="bg-blue-600 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <div id="questionContainer" class="mb-8">
                <div class="mb-6">
                    <h3 id="questionText" class="text-xl text-gray-800 leading-relaxed"></h3>
                </div>

                <div class="space-y-3">
                    <label class="flex items-center p-4 border rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input type="radio" name="answer" value="1" class="mr-3 text-blue-600">
                        <span class="text-gray-700">1점 - 전혀 그렇지 않다</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input type="radio" name="answer" value="2" class="mr-3 text-blue-600">
                        <span class="text-gray-700">2점 - 대체로 그렇지 않다</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input type="radio" name="answer" value="3" class="mr-3 text-blue-600">
                        <span class="text-gray-700">3점 - 보통이다</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input type="radio" name="answer" value="4" class="mr-3 text-blue-600">
                        <span class="text-gray-700">4점 - 대체로 그렇다</span>
                    </label>
                    <label class="flex items-center p-4 border rounded-lg hover:bg-gray-50 cursor-pointer">
                        <input type="radio" name="answer" value="5" class="mr-3 text-blue-600">
                        <span class="text-gray-700">5점 - 매우 그렇다</span>
                    </label>
                </div>
            </div>

            <div class="flex justify-between">
                <button id="prevBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-chevron-left mr-2"></i>이전
                </button>
                <button id="nextBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    다음<i class="fas fa-chevron-right ml-2"></i>
                </button>
                <button id="submitBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg hidden">
                    <i class="fas fa-check mr-2"></i>검사 완료
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-8 hidden">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 mb-4">검사 결과</h2>
                <div id="mainResult" class="bg-blue-100 border border-blue-300 rounded-lg p-6 mb-6">
                    <h3 class="text-2xl font-bold text-blue-800 mb-2">당신의 주 유형</h3>
                    <div id="mainType" class="text-4xl font-bold text-blue-900"></div>
                    <div id="mainScore" class="text-xl text-blue-700 mt-2"></div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">유형별 점수</h3>
                    <div id="scoresList" class="space-y-2"></div>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">점수 분포</h3>
                    <div style="height: 300px;">
                        <canvas id="scoresChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <button id="downloadResults" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg mr-4">
                    <i class="fas fa-download mr-2"></i>결과 다운로드 (Excel)
                </button>
                <button id="retakeTest" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg">
                    <i class="fas fa-redo mr-2"></i>다시 검사하기
                </button>
            </div>
        </div>
    </div>

    <script>
        class EnneagramSurvey {
            constructor() {
                this.questions = [];
                this.randomizedQuestions = [];
                this.currentQuestionIndex = 0;
                this.answers = {};
                this.scores = {};
                
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                document.getElementById('fileInput').addEventListener('change', (e) => this.handleFileUpload(e));
                document.getElementById('startSurvey').addEventListener('click', () => this.startSurvey());
                document.getElementById('prevBtn').addEventListener('click', () => this.previousQuestion());
                document.getElementById('nextBtn').addEventListener('click', () => this.nextQuestion());
                document.getElementById('submitBtn').addEventListener('click', () => this.submitSurvey());
                document.getElementById('downloadResults').addEventListener('click', () => this.downloadResults());
                document.getElementById('retakeTest').addEventListener('click', () => this.retakeTest());

                // Radio button change event
                document.addEventListener('change', (e) => {
                    if (e.target.name === 'answer') {
                        this.saveAnswer();
                    }
                });

                // Drag and drop functionality
                const uploadSection = document.getElementById('uploadSection');
                uploadSection.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadSection.classList.add('bg-gray-50');
                });
                
                uploadSection.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('bg-gray-50');
                });
                
                uploadSection.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('bg-gray-50');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.processFile(files[0]);
                    }
                });
            }

            handleFileUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    this.processFile(file);
                }
            }

            processFile(file) {
                if (!file.name.match(/\.(xlsx|xls)$/)) {
                    alert('엑셀 파일(.xlsx 또는 .xls)만 업로드 가능합니다.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const workbook = XLSX.read(e.target.result, { type: 'binary' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const data = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        this.parseExcelData(data);
                        this.showFileName(file.name);
                        document.getElementById('startSurvey').disabled = false;
                    } catch (error) {
                        alert('파일을 읽는 중 오류가 발생했습니다: ' + error.message);
                    }
                };
                reader.readAsBinaryString(file);
            }

            parseExcelData(data) {
                this.questions = [];
                
                // Skip header row and parse questions
                for (let i = 1; i < data.length; i++) {
                    const row = data[i];
                    if (row.length >= 3) {
                        this.questions.push({
                            type: row[0],
                            number: row[1],
                            question: row[2],
                            originalIndex: i - 1
                        });
                    }
                }

                if (this.questions.length !== 81) {
                    alert(`예상된 81개 문항이 아닌 ${this.questions.length}개 문항이 발견되었습니다.`);
                }

                console.log(`총 ${this.questions.length}개 문항이 로드되었습니다.`);
            }

            showFileName(fileName) {
                const fileNameElement = document.getElementById('fileName');
                fileNameElement.textContent = `업로드된 파일: ${fileName}`;
                fileNameElement.classList.remove('hidden');
            }

            startSurvey() {
                // Randomize questions
                this.randomizedQuestions = [...this.questions].sort(() => Math.random() - 0.5);
                this.currentQuestionIndex = 0;
                this.answers = {};
                
                document.getElementById('uploadSection').classList.add('hidden');
                document.getElementById('surveySection').classList.remove('hidden');
                document.getElementById('totalQuestions').textContent = this.randomizedQuestions.length;
                
                this.showQuestion();
            }

            showQuestion() {
                const question = this.randomizedQuestions[this.currentQuestionIndex];
                
                document.getElementById('questionText').textContent = question.question;
                document.getElementById('currentQuestion').textContent = this.currentQuestionIndex + 1;
                
                // Update progress bar
                const progress = ((this.currentQuestionIndex + 1) / this.randomizedQuestions.length) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
                
                // Clear previous answers
                const radioButtons = document.querySelectorAll('input[name="answer"]');
                radioButtons.forEach(radio => radio.checked = false);
                
                // Load saved answer if exists
                const savedAnswer = this.answers[question.originalIndex];
                if (savedAnswer) {
                    document.querySelector(`input[name="answer"][value="${savedAnswer}"]`).checked = true;
                }
                
                // Update button states
                document.getElementById('prevBtn').disabled = this.currentQuestionIndex === 0;
                document.getElementById('nextBtn').disabled = !this.isCurrentQuestionAnswered();
                
                // Show/hide submit button
                const isLastQuestion = this.currentQuestionIndex === this.randomizedQuestions.length - 1;
                document.getElementById('nextBtn').classList.toggle('hidden', isLastQuestion);
                document.getElementById('submitBtn').classList.toggle('hidden', !isLastQuestion);
            }

            saveAnswer() {
                const selectedAnswer = document.querySelector('input[name="answer"]:checked');
                if (selectedAnswer) {
                    const currentQuestion = this.randomizedQuestions[this.currentQuestionIndex];
                    this.answers[currentQuestion.originalIndex] = parseInt(selectedAnswer.value);
                    
                    document.getElementById('nextBtn').disabled = false;
                    document.getElementById('submitBtn').disabled = false;
                }
            }

            isCurrentQuestionAnswered() {
                const currentQuestion = this.randomizedQuestions[this.currentQuestionIndex];
                return this.answers[currentQuestion.originalIndex] !== undefined;
            }

            previousQuestion() {
                if (this.currentQuestionIndex > 0) {
                    this.currentQuestionIndex--;
                    this.showQuestion();
                }
            }

            nextQuestion() {
                if (this.currentQuestionIndex < this.randomizedQuestions.length - 1 && this.isCurrentQuestionAnswered()) {
                    this.currentQuestionIndex++;
                    this.showQuestion();
                }
            }

            submitSurvey() {
                if (Object.keys(this.answers).length < this.questions.length) {
                    alert('모든 문항에 답변해 주세요.');
                    return;
                }
                
                this.calculateScores();
                this.showResults();
            }

            calculateScores() {
                this.scores = {};
                
                // Initialize scores for types 1-9
                for (let i = 1; i <= 9; i++) {
                    this.scores[i] = 0;
                }
                
                // Calculate scores
                this.questions.forEach((question, index) => {
                    const type = question.type;
                    const answer = this.answers[index];
                    
                    if (this.scores[type] !== undefined && answer) {
                        this.scores[type] += answer;
                    }
                });
            }

            showResults() {
                document.getElementById('surveySection').classList.add('hidden');
                document.getElementById('resultsSection').classList.remove('hidden');
                
                // Find highest score type
                let maxScore = 0;
                let maxType = 1;
                
                Object.entries(this.scores).forEach(([type, score]) => {
                    if (score > maxScore) {
                        maxScore = score;
                        maxType = type;
                    }
                });
                
                // Display main result
                document.getElementById('mainType').textContent = `유형 ${maxType}`;
                document.getElementById('mainScore').textContent = `점수: ${maxScore}점`;
                
                // Display all scores
                this.displayScoresList();
                this.displayScoresChart();
            }

            displayScoresList() {
                const scoresList = document.getElementById('scoresList');
                scoresList.innerHTML = '';
                
                // Sort scores by value (descending)
                const sortedScores = Object.entries(this.scores)
                    .sort(([,a], [,b]) => b - a);
                
                sortedScores.forEach(([type, score], index) => {
                    const scoreItem = document.createElement('div');
                    const isHighest = index === 0;
                    
                    scoreItem.className = `flex justify-between items-center p-3 rounded-lg ${
                        isHighest ? 'bg-blue-100 border border-blue-300' : 'bg-gray-50'
                    }`;
                    
                    scoreItem.innerHTML = `
                        <span class="${isHighest ? 'font-bold text-blue-800' : 'text-gray-700'}">
                            유형 ${type}
                        </span>
                        <span class="${isHighest ? 'font-bold text-blue-800' : 'text-gray-700'}">
                            ${score}점
                        </span>
                    `;
                    
                    scoresList.appendChild(scoreItem);
                });
            }

            displayScoresChart() {
                const ctx = document.getElementById('scoresChart').getContext('2d');
                
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(this.scores).map(type => `유형 ${type}`),
                        datasets: [{
                            label: '점수',
                            data: Object.values(this.scores),
                            backgroundColor: Object.values(this.scores).map((score, index) => 
                                score === Math.max(...Object.values(this.scores)) ? '#3B82F6' : '#94A3B8'
                            ),
                            borderColor: Object.values(this.scores).map((score, index) => 
                                score === Math.max(...Object.values(this.scores)) ? '#1D4ED8' : '#64748B'
                            ),
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: Math.max(...Object.values(this.scores)) + 5
                            }
                        }
                    }
                });
            }

            downloadResults() {
                // Create workbook with results
                const wb = XLSX.utils.book_new();
                
                // Prepare data in original order
                const resultsData = [['유형', '순번', '질문', '답변', '점수']];
                
                this.questions.forEach((question, index) => {
                    const answer = this.answers[index];
                    resultsData.push([
                        question.type,
                        question.number,
                        question.question,
                        answer || '',
                        answer || ''
                    ]);
                });
                
                // Add scores summary
                resultsData.push([''], ['유형별 점수 합계'], ['유형', '점수']);
                Object.entries(this.scores).forEach(([type, score]) => {
                    resultsData.push([`유형 ${type}`, score]);
                });
                
                const ws = XLSX.utils.aoa_to_sheet(resultsData);
                XLSX.utils.book_append_sheet(wb, ws, '설문결과');
                
                const fileName = `에니어그램_검사결과_${new Date().toISOString().slice(0,10)}.xlsx`;
                XLSX.writeFile(wb, fileName);
            }

            retakeTest() {
                document.getElementById('resultsSection').classList.add('hidden');
                document.getElementById('uploadSection').classList.remove('hidden');
                
                // Reset data
                this.currentQuestionIndex = 0;
                this.answers = {};
                this.scores = {};
                this.randomizedQuestions = [];
            }
        }

        // Initialize the survey when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new EnneagramSurvey();
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDsVH3BTxdM6F6KhuoSRkUabEIbRjFsUJwQHaiG6BP45w3Zi2ZAhNn%2F43w2nmodM%2F%2BuJs3W9nAQmhkKqsrgXKOaBWLxkOu932gaThTDDjhDXLZDHzpLKsvYGWP4i2njAJ8z5HONoqsSa5VSNCKQilm9%2Ba69kHBTpV2Z4HALB5D7iEgtI7E9Mk3ybEu2oxtXRTaaaCMpQaVB2CdNKpM8r%2B1kO1nDf8ANyTAFM%2FsUX9Nc%2FfkqgXyg%2B4kf1xFIV%2F9b2LZwXxeVLJK6S8mxpM2Wvs%2BtSKTCJxlekuErd0BCDs7PNazkvJKVOjP%2F0tpro7fMuOpK8OZP1TX%2BjttH1yu1fvo%2BuYWvMWMUtFd8l5Y0RFT%2BMUHhdxPwaVDWPBMLI2XwEcVuxEwLPGAkMStRL9kumexEVvpiddsFwDf2xfhL8G7%2FlRcr4KSQQr6PSn%2FpLpzxnoLuQD3VJKTkkHtoLjObsXsbzyhhwAdTbOx3i1jPyyU6pLRtaBplSirfryfCbsV3iTFw%3D%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDsVH3BTxdM6F6KhuoSRkUabEIbRjFsUJwQHaiG6BP45w3Zi2ZAhNn/43w2nmodM/+uJs3W9nAQmhkKqsrgXKOaBWLxkOu932gaThTDDjhDXLZDHzpLKsvYGWP4i2njAJ8z5HONoqsSa5VSNCKQilm9+a69kHBTpV2Z4HALB5D7iEgtI7E9Mk3ybEu2oxtXRTaaaCMpQaVB2CdNKpM8r+1kO1nDf8ANyTAFM/sUX9Nc/fkqgXyg+4kf1xFIV/9b2LZwXxeVLJK6S8mxpM2Wvs+tSKTCJxlekuErd0BCDs7PNazkvJKVOjP/0tpro7fMuOpK8OZP1TX+jttH1yu1fvo+uYWvMWMUtFd8l5Y0RFT+MUHhdxPwaVDWPBMLI2XwEcVuxEwLPGAkMStRL9kumexEVvpiddsFwDf2xfhL8G7/lRcr4KSQQr6PSn/pLpzxnoLuQD3VJKTkkHtoLjObsXsbzyhhwAdTbOx3i1jPyyU6pLRtaBplSirfryfCbsV3iTFw==";
    </script>
    
        <script id="html_badge_script2" src="https://www.genspark.ai/html_badge.js"></script>
        
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    